{"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\springboot\\\\src\\\\open-chats\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\springboot\",\"filename\":\"D:\\\\springboot\\\\src\\\\open-chats\\\\app.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\springboot\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"transform-unicode-sets-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-class-static-block\",\"visitor\":{\"ClassBody\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-private-property-in-object\",\"visitor\":{\"BinaryExpression\":{\"enter\":[null]}},\"options\":{\"loose\":\"#__internal__@babel/preset-env__prefer-false-but-true-is-ok-if-it-prevents-an-error\"},\"externalDependencies\":[]},{\"key\":\"transform-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{\"loose\":\"#__internal__@babel/preset-env__prefer-false-but-true-is-ok-if-it-prevents-an-error\"},\"externalDependencies\":[]},{\"key\":\"transform-private-methods\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{\"loose\":\"#__internal__@babel/preset-env__prefer-false-but-true-is-ok-if-it-prevents-an-error\"},\"externalDependencies\":[]},{\"key\":\"transform-numeric-separator\",\"visitor\":{\"NumericLiteral\":{\"enter\":[null]},\"BigIntLiteral\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-logical-assignment-operators\",\"visitor\":{\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-nullish-coalescing-operator\",\"visitor\":{\"LogicalExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-optional-chaining\",\"visitor\":{\"OptionalCallExpression\":{\"enter\":[null]},\"OptionalMemberExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-json-strings\",\"visitor\":{\"DirectiveLiteral\":{\"enter\":[null]},\"StringLiteral\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-optional-catch-binding\",\"visitor\":{\"CatchClause\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-parameters\",\"visitor\":{\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-async-generator-functions\",\"visitor\":{\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-dotall-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-unicode-property-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-named-capturing-groups-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-async-to-generator\",\"visitor\":{\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-exponentiation-operator\",\"visitor\":{\"AssignmentExpression\":{\"enter\":[null]},\"BinaryExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-template-literals\",\"visitor\":{\"TaggedTemplateExpression\":{\"enter\":[null]},\"TemplateLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-literals\",\"visitor\":{\"NumericLiteral\":{\"enter\":[null]},\"StringLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-function-name\",\"visitor\":{\"FunctionExpression\":{\"exit\":[null]},\"ObjectProperty\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-arrow-functions\",\"visitor\":{\"ArrowFunctionExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-block-scoped-functions\",\"visitor\":{\"BlockStatement\":{\"enter\":[null]},\"SwitchCase\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-classes\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]},\"ClassExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-object-super\",\"visitor\":{\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"DoWhileStatement\":{\"exit\":[null]},\"ForInStatement\":{\"exit\":[null]},\"ForStatement\":{\"exit\":[null]},\"WhileStatement\":{\"exit\":[null]},\"ForOfStatement\":{\"exit\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-shorthand-properties\",\"visitor\":{\"ObjectMethod\":{\"enter\":[null]},\"ObjectProperty\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-duplicate-keys\",\"visitor\":{\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-computed-properties\",\"visitor\":{\"ObjectExpression\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-for-of\",\"visitor\":{\"ForOfStatement\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-sticky-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-unicode-escapes\",\"visitor\":{\"Identifier\":{\"enter\":[null]},\"TemplateElement\":{\"enter\":[null]},\"_exploded\":true,\"StringLiteral\":{\"enter\":[null]},\"DirectiveLiteral\":{\"enter\":[null]},\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-unicode-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-spread\",\"visitor\":{\"ArrayExpression\":{\"enter\":[null]},\"CallExpression\":{\"enter\":[null]},\"NewExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-destructuring\",\"visitor\":{\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"VariableDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-block-scoping\",\"visitor\":{\"VariableDeclaration\":{\"enter\":[null,null]},\"BlockStatement\":{\"enter\":[null]},\"SwitchCase\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]},\"DoWhileStatement\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForStatement\":{\"enter\":[null]},\"WhileStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-typeof-symbol\",\"visitor\":{\"UnaryExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"BlockStatement\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"DoWhileStatement\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForStatement\":{\"enter\":[null]},\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"Program\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"SwitchStatement\":{\"enter\":[null]},\"WhileStatement\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"StaticBlock\":{\"enter\":[null]},\"TSModuleBlock\":{\"enter\":[null]},\"AssignmentPattern\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectPattern\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-new-target\",\"visitor\":{\"MetaProperty\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-regenerator\",\"visitor\":{\"ObjectMethod\":{\"enter\":[null],\"exit\":[null]},\"ClassMethod\":{\"enter\":[null],\"exit\":[null]},\"ClassPrivateMethod\":{\"enter\":[null],\"exit\":[null]},\"FunctionDeclaration\":{\"exit\":[null]},\"FunctionExpression\":{\"exit\":[null]},\"ArrowFunctionExpression\":{\"exit\":[null]},\"MemberExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-member-expression-literals\",\"visitor\":{\"MemberExpression\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-property-literals\",\"visitor\":{\"ObjectProperty\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-reserved-words\",\"visitor\":{\"_exploded\":true,\"_verified\":true,\"Identifier\":{\"enter\":[null,null]},\"JSXIdentifier\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-export-namespace-from\",\"visitor\":{\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"Program\":{\"exit\":[null]},\"_exploded\":true,\"CallExpression\":{\"enter\":[null]},\"ImportExpression\":{\"enter\":[null]},\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-dynamic-import\",\"visitor\":{\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-top-level-await\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-import-meta\",\"visitor\":{},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.23.7:development":{"value":{"code":"\"use strict\";\n\nvar express = require(\"express\");\nvar path = require(\"path\");\n\n//morgan : 서버에 들어오는 요청과 관련된 정보를 로그를 남길 수 있음(middleware와 유사)\nvar morgan = require(\"morgan\");\nvar session = require(\"express-session\");\nvar mysql = require(\"mysql\");\nvar http = require(\"http\");\nvar axios = require(\"axios\");\nvar conn = mysql.createConnection({\n  host: \"175.198.206.137\",\n  port: 3306,\n  user: \"q\",\n  password: \"q\",\n  database: \"follaw\"\n});\nconn.connect(function (err) {\n  if (err) {\n    console.error(\"MySQL 연결 오류\");\n    return;\n  }\n  console.log(\"MySQL에 성공적으로 연결되었습니다.\");\n});\nvar app = express();\napp.set(\"port\", process.env.PORT || 3000);\napp.set(\"views\", __dirname + \"/views\");\napp.set(\"view engine\", \"pug\");\napp.use(morgan(\"dev\"));\napp.use(\"/public\", express[\"static\"](__dirname + \"/public\"));\napp.use(express.json());\napp.use(express.urlencoded({\n  extended: false\n}));\napp.use(session({\n  resave: false,\n  saveUninitialized: false,\n  //COOKIE_SECRET 환경 변수가 설정되어 있다면 그 값을 사용하고,\n  //설정되어 있지 않다면 \"secret\"이라는 기본값을 사용하여 세션 데이터를 암호화\n  secret: process.env.COOKIE_SECRET || \"secret\",\n  cookie: {\n    //httpOnly: true는 클라이언트에서 세션 쿠키에 접근할 때 JavaScript를 통한 접근을 막는 옵션\n    httpOnly: true,\n    //secure: false는 세션 쿠키를 안전한 연결(HTTPS)을 통해서만 전송해야 하는지 여부를 설정하는 옵션\n    secure: false\n  }\n}));\n\n// DB 연결\n// app.set(\"db\", conn);\napp.set(\"dummyDb\", {\n  rooms: new Array(),\n  users: new Array()\n});\napp.get(\"/\", function (req, res) {\n  // TODO: add user\n  return res.render(\"index\");\n});\napp.post(\"/\", function (req, res) {\n  // TODO: add user\n  return res.render(\"index\");\n});\napp.post(\"/newRoom\", function (req, res) {\n  var title = req.body.title;\n  var roomId = req.sessionID + Date.now();\n  var totalCount = 0;\n  var _app$get = app.get(\"dummyDb\"),\n    rooms = _app$get.rooms;\n  rooms.push({\n    title: title,\n    roomId: roomId,\n    totalCount: totalCount\n  });\n\n  // 채팅방 새로 생성시 홈에 있는 사람들에게 새로은 방 목록 전송\n  // Q?: 본인은 왜 제외될까?\n  // A!: 나는 현재 연결된 소켓이 없는상태임 home에서 newroom 으로 갈때 connection이 끊어지고\n  //     redirect로 /chat/:roomId로 보내져야 chat.js에서 connection을 연결함\n  app.get(\"wss\").clients.forEach(function (client) {\n    if (client.location === \"index\" && client.readyState === client.OPEN) client.send(JSON.stringify(rooms));\n  });\n  return res.redirect(\"/chat/\".concat(roomId));\n});\napp.get(\"/chat/:roomId\", function (req, res) {\n  var _app$get$rooms$find = app.get(\"dummyDb\").rooms.find(function (room) {\n      return room.roomId === req.params.roomId;\n    }),\n    title = _app$get$rooms$find.title;\n  //res.locals는 응답 객체(res)의 속성으로, 해당 응답에 대한 로컬 변수를 설정하고 사용할 수 있게 해줌\n  res.locals.title = title;\n  //chat 파일을 렌더링하여 해당 파일에서 title 변수를 사용할 수 있음\n  res.render(\"chat\");\n});\n\n// let totalCount = 0;\n\napp.post(\"/leave-room\", function (req, res) {\n  var _req$body = req.body,\n    title = _req$body.title,\n    count = _req$body.count;\n  console.log(\"app.js/title :\" + title);\n  console.log(\"app.js/count :\" + count);\n  var _app$get2 = app.get(\"dummyDb\"),\n    rooms = _app$get2.rooms;\n  console.log(rooms);\n  console.log(\"--------------------\");\n\n  // rooms.totalCount += count;\n  // console.log(\"totalCount : \" + totalCount);\n\n  var foundRoom = rooms.find(function (room) {\n    return room.title === title;\n  });\n  console.log(\"app.js/foundRoom.totalCount :\" + foundRoom.totalCount);\n  if (foundRoom) {\n    foundRoom.totalCount += count;\n    console.log(\"app.js/totalCount111 : \" + foundRoom.totalCount);\n    if (foundRoom.totalCount === 2) {\n      var index = rooms.indexOf(foundRoom);\n      console.log(\"app.js/index : \" + index);\n      if (index !== -1) {\n        rooms.splice(index, 1);\n      }\n    }\n    console.log(\"app.js/totalCount222 : \" + foundRoom.totalCount);\n    console.log(rooms);\n  }\n  return res.render(\"index\", {\n    rooms: rooms\n  });\n});\napp.use(function (err, req, res, next) {\n  res.locals.message = err.message;\n  res.locals.error = process.env.NODE_ENV !== \" production\" ? err : {};\n  res.status(err.status || 500).render(\"error\");\n});\nvar expressServer = app.listen(app.get(\"port\"), function () {\n  return console.log(\"Listening on http://localhost:3000\");\n});\n\n// socket\nrequire(\"./socket\")(expressServer, app);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInBhdGgiLCJtb3JnYW4iLCJzZXNzaW9uIiwibXlzcWwiLCJodHRwIiwiYXhpb3MiLCJjb25uIiwiY3JlYXRlQ29ubmVjdGlvbiIsImhvc3QiLCJwb3J0IiwidXNlciIsInBhc3N3b3JkIiwiZGF0YWJhc2UiLCJjb25uZWN0IiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwibG9nIiwiYXBwIiwic2V0IiwicHJvY2VzcyIsImVudiIsIlBPUlQiLCJfX2Rpcm5hbWUiLCJ1c2UiLCJqc29uIiwidXJsZW5jb2RlZCIsImV4dGVuZGVkIiwicmVzYXZlIiwic2F2ZVVuaW5pdGlhbGl6ZWQiLCJzZWNyZXQiLCJDT09LSUVfU0VDUkVUIiwiY29va2llIiwiaHR0cE9ubHkiLCJzZWN1cmUiLCJyb29tcyIsIkFycmF5IiwidXNlcnMiLCJnZXQiLCJyZXEiLCJyZXMiLCJyZW5kZXIiLCJwb3N0IiwidGl0bGUiLCJib2R5Iiwicm9vbUlkIiwic2Vzc2lvbklEIiwiRGF0ZSIsIm5vdyIsInRvdGFsQ291bnQiLCJfYXBwJGdldCIsInB1c2giLCJjbGllbnRzIiwiZm9yRWFjaCIsImNsaWVudCIsImxvY2F0aW9uIiwicmVhZHlTdGF0ZSIsIk9QRU4iLCJzZW5kIiwiSlNPTiIsInN0cmluZ2lmeSIsInJlZGlyZWN0IiwiY29uY2F0IiwiX2FwcCRnZXQkcm9vbXMkZmluZCIsImZpbmQiLCJyb29tIiwicGFyYW1zIiwibG9jYWxzIiwiX3JlcSRib2R5IiwiY291bnQiLCJfYXBwJGdldDIiLCJmb3VuZFJvb20iLCJpbmRleCIsImluZGV4T2YiLCJzcGxpY2UiLCJuZXh0IiwibWVzc2FnZSIsIk5PREVfRU5WIiwic3RhdHVzIiwiZXhwcmVzc1NlcnZlciIsImxpc3RlbiJdLCJzb3VyY2VSb290IjoiRDpcXHNwcmluZ2Jvb3RcXHNyY1xcb3Blbi1jaGF0c1xcIiwic291cmNlcyI6WyJhcHAuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoXCJleHByZXNzXCIpO1xyXG5jb25zdCBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XHJcblxyXG4vL21vcmdhbiA6IOyEnOuyhOyXkCDrk6TslrTsmKTripQg7JqU7LKt6rO8IOq0gOugqOuQnCDsoJXrs7Trpbwg66Gc6re466W8IOuCqOq4uCDsiJgg7J6I7J2MKG1pZGRsZXdhcmXsmYAg7Jyg7IKsKVxyXG5jb25zdCBtb3JnYW4gPSByZXF1aXJlKFwibW9yZ2FuXCIpO1xyXG5jb25zdCBzZXNzaW9uID0gcmVxdWlyZShcImV4cHJlc3Mtc2Vzc2lvblwiKTtcclxuXHJcbmNvbnN0IG15c3FsID0gcmVxdWlyZShcIm15c3FsXCIpO1xyXG5cclxuY29uc3QgaHR0cCA9IHJlcXVpcmUoXCJodHRwXCIpO1xyXG5jb25zdCBheGlvcyA9IHJlcXVpcmUoXCJheGlvc1wiKTtcclxuXHJcbmNvbnN0IGNvbm4gPSBteXNxbC5jcmVhdGVDb25uZWN0aW9uKHtcclxuICBob3N0OiBcIjE3NS4xOTguMjA2LjEzN1wiLFxyXG4gIHBvcnQ6IDMzMDYsXHJcbiAgdXNlcjogXCJxXCIsXHJcbiAgcGFzc3dvcmQ6IFwicVwiLFxyXG4gIGRhdGFiYXNlOiBcImZvbGxhd1wiLFxyXG59KTtcclxuXHJcbmNvbm4uY29ubmVjdCgoZXJyKSA9PiB7XHJcbiAgaWYgKGVycikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIk15U1FMIOyXsOqysCDsmKTrpZhcIik7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIGNvbnNvbGUubG9nKFwiTXlTUUzsl5Ag7ISx6rO17KCB7Jy866GcIOyXsOqysOuQmOyXiOyKteuLiOuLpC5cIik7XHJcbn0pO1xyXG5cclxuY29uc3QgYXBwID0gZXhwcmVzcygpO1xyXG5hcHAuc2V0KFwicG9ydFwiLCBwcm9jZXNzLmVudi5QT1JUIHx8IDMwMDApO1xyXG5hcHAuc2V0KFwidmlld3NcIiwgX19kaXJuYW1lICsgXCIvdmlld3NcIik7XHJcbmFwcC5zZXQoXCJ2aWV3IGVuZ2luZVwiLCBcInB1Z1wiKTtcclxuYXBwLnVzZShtb3JnYW4oXCJkZXZcIikpO1xyXG5hcHAudXNlKFwiL3B1YmxpY1wiLCBleHByZXNzLnN0YXRpYyhfX2Rpcm5hbWUgKyBcIi9wdWJsaWNcIikpO1xyXG5hcHAudXNlKGV4cHJlc3MuanNvbigpKTtcclxuYXBwLnVzZShleHByZXNzLnVybGVuY29kZWQoeyBleHRlbmRlZDogZmFsc2UgfSkpO1xyXG5hcHAudXNlKFxyXG4gIHNlc3Npb24oe1xyXG4gICAgcmVzYXZlOiBmYWxzZSxcclxuICAgIHNhdmVVbmluaXRpYWxpemVkOiBmYWxzZSxcclxuICAgIC8vQ09PS0lFX1NFQ1JFVCDtmZjqsr0g67OA7IiY6rCAIOyEpOygleuQmOyWtCDsnojri6TrqbQg6re4IOqwkuydhCDsgqzsmqntlZjqs6AsXHJcbiAgICAvL+yEpOygleuQmOyWtCDsnojsp4Ag7JWK64uk66m0IFwic2VjcmV0XCLsnbTrnbzripQg6riw67O46rCS7J2EIOyCrOyaqe2VmOyXrCDshLjshZgg642w7J207YSw66W8IOyVlO2YuO2ZlFxyXG4gICAgc2VjcmV0OiBwcm9jZXNzLmVudi5DT09LSUVfU0VDUkVUIHx8IFwic2VjcmV0XCIsXHJcbiAgICBjb29raWU6IHtcclxuICAgICAgLy9odHRwT25seTogdHJ1ZeuKlCDtgbTrnbzsnbTslrjtirjsl5DshJwg7IS47IWYIOy/oO2CpOyXkCDsoJHqt7ztlaAg65WMIEphdmFTY3JpcHTrpbwg7Ya17ZWcIOygkeq3vOydhCDrp4nripQg7Ji17IWYXHJcbiAgICAgIGh0dHBPbmx5OiB0cnVlLFxyXG4gICAgICAvL3NlY3VyZTogZmFsc2XripQg7IS47IWYIOy/oO2CpOulvCDslYjsoITtlZwg7Jew6rKwKEhUVFBTKeydhCDthrXtlbTshJzrp4wg7KCE7Iah7ZW07JW8IO2VmOuKlOyngCDsl6zrtoDrpbwg7ISk7KCV7ZWY64qUIOyYteyFmFxyXG4gICAgICBzZWN1cmU6IGZhbHNlLFxyXG4gICAgfSxcclxuICB9KVxyXG4pO1xyXG5cclxuLy8gREIg7Jew6rKwXHJcbi8vIGFwcC5zZXQoXCJkYlwiLCBjb25uKTtcclxuYXBwLnNldChcImR1bW15RGJcIiwgeyByb29tczogbmV3IEFycmF5KCksIHVzZXJzOiBuZXcgQXJyYXkoKSB9KTtcclxuXHJcbmFwcC5nZXQoXCIvXCIsIChyZXEsIHJlcykgPT4ge1xyXG4gIC8vIFRPRE86IGFkZCB1c2VyXHJcbiAgcmV0dXJuIHJlcy5yZW5kZXIoXCJpbmRleFwiKTtcclxufSk7XHJcblxyXG5hcHAucG9zdChcIi9cIiwgKHJlcSwgcmVzKSA9PiB7XHJcbiAgLy8gVE9ETzogYWRkIHVzZXJcclxuICByZXR1cm4gcmVzLnJlbmRlcihcImluZGV4XCIpO1xyXG59KTtcclxuXHJcbmFwcC5wb3N0KFwiL25ld1Jvb21cIiwgKHJlcSwgcmVzKSA9PiB7XHJcbiAgY29uc3QgeyB0aXRsZSB9ID0gcmVxLmJvZHk7XHJcbiAgY29uc3Qgcm9vbUlkID0gcmVxLnNlc3Npb25JRCArIERhdGUubm93KCk7XHJcbiAgbGV0IHRvdGFsQ291bnQgPSAwO1xyXG4gIGNvbnN0IHsgcm9vbXMgfSA9IGFwcC5nZXQoXCJkdW1teURiXCIpO1xyXG4gIHJvb21zLnB1c2goeyB0aXRsZSwgcm9vbUlkLCB0b3RhbENvdW50IH0pO1xyXG5cclxuICAvLyDssYTtjIXrsKkg7IOI66GcIOyDneyEseyLnCDtmYjsl5Ag7J6I64qUIOyCrOuejOuTpOyXkOqyjCDsg4jroZzsnYAg67CpIOuqqeuhnSDsoITshqFcclxuICAvLyBRPzog67O47J247J2AIOyZnCDsoJzsmbjrkKDquYw/XHJcbiAgLy8gQSE6IOuCmOuKlCDtmITsnqwg7Jew6rKw65CcIOyGjOy8k+ydtCDsl4bripTsg4Htg5zsnoQgaG9tZeyXkOyEnCBuZXdyb29tIOycvOuhnCDqsIjrlYwgY29ubmVjdGlvbuydtCDrgYrslrTsp4Dqs6BcclxuICAvLyAgICAgcmVkaXJlY3TroZwgL2NoYXQvOnJvb21JZOuhnCDrs7TrgrTsoLjslbwgY2hhdC5qc+yXkOyEnCBjb25uZWN0aW9u7J2EIOyXsOqysO2VqFxyXG4gIGFwcC5nZXQoXCJ3c3NcIikuY2xpZW50cy5mb3JFYWNoKChjbGllbnQpID0+IHtcclxuICAgIGlmIChjbGllbnQubG9jYXRpb24gPT09IFwiaW5kZXhcIiAmJiBjbGllbnQucmVhZHlTdGF0ZSA9PT0gY2xpZW50Lk9QRU4pXHJcbiAgICAgIGNsaWVudC5zZW5kKEpTT04uc3RyaW5naWZ5KHJvb21zKSk7XHJcbiAgfSk7XHJcbiAgcmV0dXJuIHJlcy5yZWRpcmVjdChgL2NoYXQvJHtyb29tSWR9YCk7XHJcbn0pO1xyXG5cclxuYXBwLmdldChcIi9jaGF0Lzpyb29tSWRcIiwgKHJlcSwgcmVzKSA9PiB7XHJcbiAgY29uc3QgeyB0aXRsZSB9ID0gYXBwXHJcbiAgICAuZ2V0KFwiZHVtbXlEYlwiKVxyXG4gICAgLnJvb21zLmZpbmQoKHJvb20pID0+IHJvb20ucm9vbUlkID09PSByZXEucGFyYW1zLnJvb21JZCk7XHJcbiAgLy9yZXMubG9jYWxz64qUIOydkeuLtSDqsJ3ssrQocmVzKeydmCDsho3shLHsnLzroZwsIO2VtOuLuSDsnZHri7Xsl5Ag64yA7ZWcIOuhnOy7rCDrs4DsiJjrpbwg7ISk7KCV7ZWY6rOgIOyCrOyaqe2VoCDsiJgg7J6I6rKMIO2VtOykjFxyXG4gIHJlcy5sb2NhbHMudGl0bGUgPSB0aXRsZTtcclxuICAvL2NoYXQg7YyM7J287J2EIOugjOuNlOunge2VmOyXrCDtlbTri7kg7YyM7J287JeQ7IScIHRpdGxlIOuzgOyImOulvCDsgqzsmqntlaAg7IiYIOyeiOydjFxyXG4gIHJlcy5yZW5kZXIoXCJjaGF0XCIpO1xyXG59KTtcclxuXHJcbi8vIGxldCB0b3RhbENvdW50ID0gMDtcclxuXHJcbmFwcC5wb3N0KFwiL2xlYXZlLXJvb21cIiwgKHJlcSwgcmVzKSA9PiB7XHJcbiAgY29uc3QgeyB0aXRsZSwgY291bnQgfSA9IHJlcS5ib2R5O1xyXG4gIGNvbnNvbGUubG9nKFwiYXBwLmpzL3RpdGxlIDpcIiArIHRpdGxlKTtcclxuICBjb25zb2xlLmxvZyhcImFwcC5qcy9jb3VudCA6XCIgKyBjb3VudCk7XHJcbiAgbGV0IHsgcm9vbXMgfSA9IGFwcC5nZXQoXCJkdW1teURiXCIpO1xyXG4gIGNvbnNvbGUubG9nKHJvb21zKTtcclxuICBjb25zb2xlLmxvZyhcIi0tLS0tLS0tLS0tLS0tLS0tLS0tXCIpO1xyXG5cclxuICAvLyByb29tcy50b3RhbENvdW50ICs9IGNvdW50O1xyXG4gIC8vIGNvbnNvbGUubG9nKFwidG90YWxDb3VudCA6IFwiICsgdG90YWxDb3VudCk7XHJcblxyXG4gIGNvbnN0IGZvdW5kUm9vbSA9IHJvb21zLmZpbmQoKHJvb20pID0+IHJvb20udGl0bGUgPT09IHRpdGxlKTtcclxuICBjb25zb2xlLmxvZyhcImFwcC5qcy9mb3VuZFJvb20udG90YWxDb3VudCA6XCIgKyBmb3VuZFJvb20udG90YWxDb3VudCk7XHJcblxyXG4gIGlmIChmb3VuZFJvb20pIHtcclxuICAgIGZvdW5kUm9vbS50b3RhbENvdW50ICs9IGNvdW50O1xyXG4gICAgY29uc29sZS5sb2coXCJhcHAuanMvdG90YWxDb3VudDExMSA6IFwiICsgZm91bmRSb29tLnRvdGFsQ291bnQpO1xyXG5cclxuICAgIGlmIChmb3VuZFJvb20udG90YWxDb3VudCA9PT0gMikge1xyXG4gICAgICBjb25zdCBpbmRleCA9IHJvb21zLmluZGV4T2YoZm91bmRSb29tKTtcclxuICAgICAgY29uc29sZS5sb2coXCJhcHAuanMvaW5kZXggOiBcIiArIGluZGV4KTtcclxuICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgIHJvb21zLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbnNvbGUubG9nKFwiYXBwLmpzL3RvdGFsQ291bnQyMjIgOiBcIiArIGZvdW5kUm9vbS50b3RhbENvdW50KTtcclxuICAgIGNvbnNvbGUubG9nKHJvb21zKTtcclxuICB9XHJcbiAgcmV0dXJuIHJlcy5yZW5kZXIoXCJpbmRleFwiLCB7IHJvb21zIH0pO1xyXG59KTtcclxuXHJcbmFwcC51c2UoKGVyciwgcmVxLCByZXMsIG5leHQpID0+IHtcclxuICByZXMubG9jYWxzLm1lc3NhZ2UgPSBlcnIubWVzc2FnZTtcclxuICByZXMubG9jYWxzLmVycm9yID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwiIHByb2R1Y3Rpb25cIiA/IGVyciA6IHt9O1xyXG4gIHJlcy5zdGF0dXMoZXJyLnN0YXR1cyB8fCA1MDApLnJlbmRlcihcImVycm9yXCIpO1xyXG59KTtcclxuXHJcbmNvbnN0IGV4cHJlc3NTZXJ2ZXIgPSBhcHAubGlzdGVuKGFwcC5nZXQoXCJwb3J0XCIpLCAoKSA9PlxyXG4gIGNvbnNvbGUubG9nKGBMaXN0ZW5pbmcgb24gaHR0cDovL2xvY2FsaG9zdDozMDAwYClcclxuKTtcclxuXHJcbi8vIHNvY2tldFxyXG5yZXF1aXJlKFwiLi9zb2NrZXRcIikoZXhwcmVzc1NlcnZlciwgYXBwKTtcclxuIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxJQUFNQyxJQUFJLEdBQUdELE9BQU8sQ0FBQyxNQUFNLENBQUM7O0FBRTVCO0FBQ0EsSUFBTUUsTUFBTSxHQUFHRixPQUFPLENBQUMsUUFBUSxDQUFDO0FBQ2hDLElBQU1HLE9BQU8sR0FBR0gsT0FBTyxDQUFDLGlCQUFpQixDQUFDO0FBRTFDLElBQU1JLEtBQUssR0FBR0osT0FBTyxDQUFDLE9BQU8sQ0FBQztBQUU5QixJQUFNSyxJQUFJLEdBQUdMLE9BQU8sQ0FBQyxNQUFNLENBQUM7QUFDNUIsSUFBTU0sS0FBSyxHQUFHTixPQUFPLENBQUMsT0FBTyxDQUFDO0FBRTlCLElBQU1PLElBQUksR0FBR0gsS0FBSyxDQUFDSSxnQkFBZ0IsQ0FBQztFQUNsQ0MsSUFBSSxFQUFFLGlCQUFpQjtFQUN2QkMsSUFBSSxFQUFFLElBQUk7RUFDVkMsSUFBSSxFQUFFLEdBQUc7RUFDVEMsUUFBUSxFQUFFLEdBQUc7RUFDYkMsUUFBUSxFQUFFO0FBQ1osQ0FBQyxDQUFDO0FBRUZO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","map":{"version":3,"names":["express","require","path","morgan","session","mysql","http","axios","conn","createConnection","host","port","user","password","database","connect","err","console","error","log","app","set","process","env","PORT","__dirname","use","json","urlencoded","extended","resave","saveUninitialized","secret","COOKIE_SECRET","cookie","httpOnly","secure","rooms","Array","users","get","req","res","render","post","title","body","roomId","sessionID","Date","now","totalCount","_app$get","push","clients","forEach","client","location","readyState","OPEN","send","JSON","stringify","redirect","concat","_app$get$rooms$find","find","room","params","locals","_req$body","count","_app$get2","foundRoom","index","indexOf","splice","next","message","NODE_ENV","status","expressServer","listen"],"sourceRoot":"D:\\springboot\\src\\open-chats\\","sources":["app.js"],"sourcesContent":["const express = require(\"express\");\r\nconst path = require(\"path\");\r\n\r\n//morgan : 서버에 들어오는 요청과 관련된 정보를 로그를 남길 수 있음(middleware와 유사)\r\nconst morgan = require(\"morgan\");\r\nconst session = require(\"express-session\");\r\n\r\nconst mysql = require(\"mysql\");\r\n\r\nconst http = require(\"http\");\r\nconst axios = require(\"axios\");\r\n\r\nconst conn = mysql.createConnection({\r\n  host: \"175.198.206.137\",\r\n  port: 3306,\r\n  user: \"q\",\r\n  password: \"q\",\r\n  database: \"follaw\",\r\n});\r\n\r\nconn.connect((err) => {\r\n  if (err) {\r\n    console.error(\"MySQL 연결 오류\");\r\n    return;\r\n  }\r\n  console.log(\"MySQL에 성공적으로 연결되었습니다.\");\r\n});\r\n\r\nconst app = express();\r\napp.set(\"port\", process.env.PORT || 3000);\r\napp.set(\"views\", __dirname + \"/views\");\r\napp.set(\"view engine\", \"pug\");\r\napp.use(morgan(\"dev\"));\r\napp.use(\"/public\", express.static(__dirname + \"/public\"));\r\napp.use(express.json());\r\napp.use(express.urlencoded({ extended: false }));\r\napp.use(\r\n  session({\r\n    resave: false,\r\n    saveUninitialized: false,\r\n    //COOKIE_SECRET 환경 변수가 설정되어 있다면 그 값을 사용하고,\r\n    //설정되어 있지 않다면 \"secret\"이라는 기본값을 사용하여 세션 데이터를 암호화\r\n    secret: process.env.COOKIE_SECRET || \"secret\",\r\n    cookie: {\r\n      //httpOnly: true는 클라이언트에서 세션 쿠키에 접근할 때 JavaScript를 통한 접근을 막는 옵션\r\n      httpOnly: true,\r\n      //secure: false는 세션 쿠키를 안전한 연결(HTTPS)을 통해서만 전송해야 하는지 여부를 설정하는 옵션\r\n      secure: false,\r\n    },\r\n  })\r\n);\r\n\r\n// DB 연결\r\n// app.set(\"db\", conn);\r\napp.set(\"dummyDb\", { rooms: new Array(), users: new Array() });\r\n\r\napp.get(\"/\", (req, res) => {\r\n  // TODO: add user\r\n  return res.render(\"index\");\r\n});\r\n\r\napp.post(\"/\", (req, res) => {\r\n  // TODO: add user\r\n  return res.render(\"index\");\r\n});\r\n\r\napp.post(\"/newRoom\", (req, res) => {\r\n  const { title } = req.body;\r\n  const roomId = req.sessionID + Date.now();\r\n  let totalCount = 0;\r\n  const { rooms } = app.get(\"dummyDb\");\r\n  rooms.push({ title, roomId, totalCount });\r\n\r\n  // 채팅방 새로 생성시 홈에 있는 사람들에게 새로은 방 목록 전송\r\n  // Q?: 본인은 왜 제외될까?\r\n  // A!: 나는 현재 연결된 소켓이 없는상태임 home에서 newroom 으로 갈때 connection이 끊어지고\r\n  //     redirect로 /chat/:roomId로 보내져야 chat.js에서 connection을 연결함\r\n  app.get(\"wss\").clients.forEach((client) => {\r\n    if (client.location === \"index\" && client.readyState === client.OPEN)\r\n      client.send(JSON.stringify(rooms));\r\n  });\r\n  return res.redirect(`/chat/${roomId}`);\r\n});\r\n\r\napp.get(\"/chat/:roomId\", (req, res) => {\r\n  const { title } = app\r\n    .get(\"dummyDb\")\r\n    .rooms.find((room) => room.roomId === req.params.roomId);\r\n  //res.locals는 응답 객체(res)의 속성으로, 해당 응답에 대한 로컬 변수를 설정하고 사용할 수 있게 해줌\r\n  res.locals.title = title;\r\n  //chat 파일을 렌더링하여 해당 파일에서 title 변수를 사용할 수 있음\r\n  res.render(\"chat\");\r\n});\r\n\r\n// let totalCount = 0;\r\n\r\napp.post(\"/leave-room\", (req, res) => {\r\n  const { title, count } = req.body;\r\n  console.log(\"app.js/title :\" + title);\r\n  console.log(\"app.js/count :\" + count);\r\n  let { rooms } = app.get(\"dummyDb\");\r\n  console.log(rooms);\r\n  console.log(\"--------------------\");\r\n\r\n  // rooms.totalCount += count;\r\n  // console.log(\"totalCount : \" + totalCount);\r\n\r\n  const foundRoom = rooms.find((room) => room.title === title);\r\n  console.log(\"app.js/foundRoom.totalCount :\" + foundRoom.totalCount);\r\n\r\n  if (foundRoom) {\r\n    foundRoom.totalCount += count;\r\n    console.log(\"app.js/totalCount111 : \" + foundRoom.totalCount);\r\n\r\n    if (foundRoom.totalCount === 2) {\r\n      const index = rooms.indexOf(foundRoom);\r\n      console.log(\"app.js/index : \" + index);\r\n      if (index !== -1) {\r\n        rooms.splice(index, 1);\r\n      }\r\n    }\r\n    console.log(\"app.js/totalCount222 : \" + foundRoom.totalCount);\r\n    console.log(rooms);\r\n  }\r\n  return res.render(\"index\", { rooms });\r\n});\r\n\r\napp.use((err, req, res, next) => {\r\n  res.locals.message = err.message;\r\n  res.locals.error = process.env.NODE_ENV !== \" production\" ? err : {};\r\n  res.status(err.status || 500).render(\"error\");\r\n});\r\n\r\nconst expressServer = app.listen(app.get(\"port\"), () =>\r\n  console.log(`Listening on http://localhost:3000`)\r\n);\r\n\r\n// socket\r\nrequire(\"./socket\")(expressServer, app);\r\n"],"mappings":"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"}},"mtime":1705659544144},"{\"assumptions\":{},\"sourceRoot\":\"D:\\\\springboot\\\\src\\\\open-chats\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"D:\\\\springboot\",\"filename\":\"D:\\\\springboot\\\\src\\\\open-chats\\\\socket.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"D:\\\\springboot\",\"rootMode\":\"root\",\"plugins\":[{\"key\":\"transform-unicode-sets-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-class-static-block\",\"visitor\":{\"ClassBody\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-private-property-in-object\",\"visitor\":{\"BinaryExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"loose\":\"#__internal__@babel/preset-env__prefer-false-but-true-is-ok-if-it-prevents-an-error\"},\"externalDependencies\":[]},{\"key\":\"transform-class-properties\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{\"loose\":\"#__internal__@babel/preset-env__prefer-false-but-true-is-ok-if-it-prevents-an-error\"},\"externalDependencies\":[]},{\"key\":\"transform-private-methods\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]}},\"options\":{\"loose\":\"#__internal__@babel/preset-env__prefer-false-but-true-is-ok-if-it-prevents-an-error\"},\"externalDependencies\":[]},{\"key\":\"transform-numeric-separator\",\"visitor\":{\"NumericLiteral\":{\"enter\":[null]},\"BigIntLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-logical-assignment-operators\",\"visitor\":{\"AssignmentExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-nullish-coalescing-operator\",\"visitor\":{\"LogicalExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-optional-chaining\",\"visitor\":{\"OptionalCallExpression\":{\"enter\":[null]},\"OptionalMemberExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-json-strings\",\"visitor\":{\"DirectiveLiteral\":{\"enter\":[null]},\"StringLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-optional-catch-binding\",\"visitor\":{\"CatchClause\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-parameters\",\"visitor\":{\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-async-generator-functions\",\"visitor\":{\"Program\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-object-rest-spread\",\"visitor\":{\"VariableDeclarator\":{\"enter\":[null]},\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectExpression\":{\"enter\":[null]},\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-dotall-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-unicode-property-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-named-capturing-groups-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-async-to-generator\",\"visitor\":{\"_exploded\":true,\"_verified\":true,\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-exponentiation-operator\",\"visitor\":{\"AssignmentExpression\":{\"enter\":[null]},\"BinaryExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-template-literals\",\"visitor\":{\"TaggedTemplateExpression\":{\"enter\":[null]},\"TemplateLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-literals\",\"visitor\":{\"NumericLiteral\":{\"enter\":[null]},\"StringLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-function-name\",\"visitor\":{\"FunctionExpression\":{\"exit\":[null]},\"ObjectProperty\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-arrow-functions\",\"visitor\":{\"ArrowFunctionExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-block-scoped-functions\",\"visitor\":{\"BlockStatement\":{\"enter\":[null]},\"SwitchCase\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-classes\",\"visitor\":{\"ExportDefaultDeclaration\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]},\"ClassExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-object-super\",\"visitor\":{\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"DoWhileStatement\":{\"exit\":[null]},\"ForInStatement\":{\"exit\":[null]},\"ForStatement\":{\"exit\":[null]},\"WhileStatement\":{\"exit\":[null]},\"ForOfStatement\":{\"exit\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-shorthand-properties\",\"visitor\":{\"ObjectMethod\":{\"enter\":[null]},\"ObjectProperty\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-duplicate-keys\",\"visitor\":{\"ObjectExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-computed-properties\",\"visitor\":{\"ObjectExpression\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-for-of\",\"visitor\":{\"ForOfStatement\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-sticky-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-unicode-escapes\",\"visitor\":{\"Identifier\":{\"enter\":[null]},\"TemplateElement\":{\"enter\":[null]},\"_exploded\":true,\"StringLiteral\":{\"enter\":[null]},\"DirectiveLiteral\":{\"enter\":[null]},\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-unicode-regex\",\"visitor\":{\"RegExpLiteral\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-spread\",\"visitor\":{\"ArrayExpression\":{\"enter\":[null]},\"CallExpression\":{\"enter\":[null]},\"NewExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-destructuring\",\"visitor\":{\"ExportNamedDeclaration\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"AssignmentExpression\":{\"enter\":[null]},\"VariableDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"ForInStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-block-scoping\",\"visitor\":{\"VariableDeclaration\":{\"enter\":[null,null]},\"BlockStatement\":{\"enter\":[null]},\"SwitchCase\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]},\"DoWhileStatement\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForStatement\":{\"enter\":[null]},\"WhileStatement\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-typeof-symbol\",\"visitor\":{\"UnaryExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true,\"BlockStatement\":{\"enter\":[null]},\"CatchClause\":{\"enter\":[null]},\"DoWhileStatement\":{\"enter\":[null]},\"ForInStatement\":{\"enter\":[null]},\"ForStatement\":{\"enter\":[null]},\"FunctionDeclaration\":{\"enter\":[null]},\"FunctionExpression\":{\"enter\":[null]},\"Program\":{\"enter\":[null]},\"ObjectMethod\":{\"enter\":[null]},\"SwitchStatement\":{\"enter\":[null]},\"WhileStatement\":{\"enter\":[null]},\"ArrowFunctionExpression\":{\"enter\":[null]},\"ClassExpression\":{\"enter\":[null]},\"ClassDeclaration\":{\"enter\":[null]},\"ForOfStatement\":{\"enter\":[null]},\"ClassMethod\":{\"enter\":[null]},\"ClassPrivateMethod\":{\"enter\":[null]},\"StaticBlock\":{\"enter\":[null]},\"TSModuleBlock\":{\"enter\":[null]},\"AssignmentPattern\":{\"enter\":[null]},\"ArrayPattern\":{\"enter\":[null]},\"ObjectPattern\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-new-target\",\"visitor\":{\"MetaProperty\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-regenerator\",\"visitor\":{\"ObjectMethod\":{\"enter\":[null],\"exit\":[null]},\"ClassMethod\":{\"enter\":[null],\"exit\":[null]},\"ClassPrivateMethod\":{\"enter\":[null],\"exit\":[null]},\"FunctionDeclaration\":{\"exit\":[null]},\"FunctionExpression\":{\"exit\":[null]},\"ArrowFunctionExpression\":{\"exit\":[null]},\"MemberExpression\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-member-expression-literals\",\"visitor\":{\"MemberExpression\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-property-literals\",\"visitor\":{\"ObjectProperty\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-reserved-words\",\"visitor\":{\"_exploded\":true,\"_verified\":true,\"Identifier\":{\"enter\":[null,null]},\"JSXIdentifier\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-export-namespace-from\",\"visitor\":{\"ExportNamedDeclaration\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"Program\":{\"exit\":[null]},\"_exploded\":true,\"CallExpression\":{\"enter\":[null]},\"ImportExpression\":{\"enter\":[null]},\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"transform-dynamic-import\",\"visitor\":{\"Program\":{\"enter\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-top-level-await\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]},{\"key\":\"syntax-import-meta\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"useBuiltIns\":false},\"externalDependencies\":[]}],\"presets\":[]}:7.23.7:development":{"value":{"code":"\"use strict\";\n\nvar ws = require(\"ws\");\n\n//module.exports : 모듈을 내보내는 데 사용되는 특수한 객체\n//다른 파일에서 해당 모듈을 가져와 사용 가능(require() 이용)\nmodule.exports = function (server, app) {\n  //ws 모듈의 Server 클래스(WebSocket 서버를 생성하고 관리)를 사용하여 WebSocket 서버를 생성하는 구문\n  var wss = new ws.Server({\n    server: server\n  });\n  // for sending a rooms data when a new room is created\n  // used at app.post('newroom') on app.js\n  app.set(\"wss\", wss);\n\n  // Backend에서 socket을 사용할 준비 완료\n  wss.on(\"connection\", function (ws, req) {\n    if (req.url === \"/rooms\") {\n      ws.location = \"index\";\n      // get a data when into index\n      ws.send(JSON.stringify(app.get(\"dummyDb\").rooms));\n    } else if (req.url.startsWith(\"/chat/\")) {\n      ws.location = req.url.split(\"/\")[2];\n      ws.on(\"message\", function (message) {\n        // send message to open sockets in my room without me\n        //클라이언트가 현재 메시지를 보낸 클라이언트(ws)와 같지 않고,\n        //상태가 OPEN인 경우, 그리고 같은 방(location)에 있는 경우에만 메세지 전송\n        wss.clients.forEach(function (client) {\n          if (client !== ws && client.readyState === ws.OPEN && client.location === ws.location) client.send(message.toString());\n          // send message to\n          // open sockets (client.readyState === ws.OPEN)\n          // in my room (client.roomId === ws.roomId)\n          // without me (client !== ws)\n        });\n      });\n    }\n    ws.on(\"error\", function (error) {\n      console.error(error);\n      app.locals.message = error.message;\n      app.locals.error = process.env.NODE_ENV !== \" production\" ? error : {};\n      app.render(\"error\");\n    });\n    ws.on(\"close\", function () {\n      return console.log(\"\".concat(req.url, \" connection close\"));\n    });\n  });\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ3cyIsInJlcXVpcmUiLCJtb2R1bGUiLCJleHBvcnRzIiwic2VydmVyIiwiYXBwIiwid3NzIiwiU2VydmVyIiwic2V0Iiwib24iLCJyZXEiLCJ1cmwiLCJsb2NhdGlvbiIsInNlbmQiLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0Iiwicm9vbXMiLCJzdGFydHNXaXRoIiwic3BsaXQiLCJtZXNzYWdlIiwiY2xpZW50cyIsImZvckVhY2giLCJjbGllbnQiLCJyZWFkeVN0YXRlIiwiT1BFTiIsInRvU3RyaW5nIiwiZXJyb3IiLCJjb25zb2xlIiwibG9jYWxzIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwicmVuZGVyIiwibG9nIiwiY29uY2F0Il0sInNvdXJjZVJvb3QiOiJEOlxcc3ByaW5nYm9vdFxcc3JjXFxvcGVuLWNoYXRzXFwiLCJzb3VyY2VzIjpbInNvY2tldC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB3cyA9IHJlcXVpcmUoXCJ3c1wiKTtcclxuXHJcbi8vbW9kdWxlLmV4cG9ydHMgOiDrqqjrk4jsnYQg64K067O064K064qUIOuNsCDsgqzsmqnrkJjripQg7Yq57IiY7ZWcIOqwneyytFxyXG4vL+uLpOuluCDtjIzsnbzsl5DshJwg7ZW064u5IOuqqOuTiOydhCDqsIDsoLjsmYAg7IKs7JqpIOqwgOuKpShyZXF1aXJlKCkg7J207JqpKVxyXG5tb2R1bGUuZXhwb3J0cyA9IChzZXJ2ZXIsIGFwcCkgPT4ge1xyXG4gIC8vd3Mg66qo65OI7J2YIFNlcnZlciDtgbTrnpjsiqQoV2ViU29ja2V0IOyEnOuyhOulvCDsg53shLHtlZjqs6Ag6rSA66asKeulvCDsgqzsmqntlZjsl6wgV2ViU29ja2V0IOyEnOuyhOulvCDsg53shLHtlZjripQg6rWs66y4XHJcbiAgY29uc3Qgd3NzID0gbmV3IHdzLlNlcnZlcih7IHNlcnZlciB9KTtcclxuICAvLyBmb3Igc2VuZGluZyBhIHJvb21zIGRhdGEgd2hlbiBhIG5ldyByb29tIGlzIGNyZWF0ZWRcclxuICAvLyB1c2VkIGF0IGFwcC5wb3N0KCduZXdyb29tJykgb24gYXBwLmpzXHJcbiAgYXBwLnNldChcIndzc1wiLCB3c3MpO1xyXG5cclxuICAvLyBCYWNrZW5k7JeQ7IScIHNvY2tldOydhCDsgqzsmqntlaAg7KSA67mEIOyZhOujjFxyXG4gIHdzcy5vbihcImNvbm5lY3Rpb25cIiwgKHdzLCByZXEpID0+IHtcclxuICAgIGlmIChyZXEudXJsID09PSBcIi9yb29tc1wiKSB7XHJcbiAgICAgIHdzLmxvY2F0aW9uID0gXCJpbmRleFwiO1xyXG4gICAgICAvLyBnZXQgYSBkYXRhIHdoZW4gaW50byBpbmRleFxyXG4gICAgICB3cy5zZW5kKEpTT04uc3RyaW5naWZ5KGFwcC5nZXQoXCJkdW1teURiXCIpLnJvb21zKSk7XHJcbiAgICB9IGVsc2UgaWYgKHJlcS51cmwuc3RhcnRzV2l0aChcIi9jaGF0L1wiKSkge1xyXG4gICAgICB3cy5sb2NhdGlvbiA9IHJlcS51cmwuc3BsaXQoXCIvXCIpWzJdO1xyXG4gICAgICB3cy5vbihcIm1lc3NhZ2VcIiwgKG1lc3NhZ2UpID0+IHtcclxuICAgICAgICAvLyBzZW5kIG1lc3NhZ2UgdG8gb3BlbiBzb2NrZXRzIGluIG15IHJvb20gd2l0aG91dCBtZVxyXG4gICAgICAgIC8v7YG065287J207Ja47Yq46rCAIO2YhOyerCDrqZTsi5zsp4Drpbwg67O064K4IO2BtOudvOydtOyWuO2KuCh3cynsmYAg6rCZ7KeAIOyViuqzoCxcclxuICAgICAgICAvL+yDge2DnOqwgCBPUEVO7J24IOqyveyasCwg6re466as6rOgIOqwmeydgCDrsKkobG9jYXRpb24p7JeQIOyeiOuKlCDqsr3smrDsl5Drp4wg66mU7IS47KeAIOyghOyGoVxyXG4gICAgICAgIHdzcy5jbGllbnRzLmZvckVhY2goKGNsaWVudCkgPT4ge1xyXG4gICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICBjbGllbnQgIT09IHdzICYmXHJcbiAgICAgICAgICAgIGNsaWVudC5yZWFkeVN0YXRlID09PSB3cy5PUEVOICYmXHJcbiAgICAgICAgICAgIGNsaWVudC5sb2NhdGlvbiA9PT0gd3MubG9jYXRpb25cclxuICAgICAgICAgIClcclxuICAgICAgICAgICAgY2xpZW50LnNlbmQobWVzc2FnZS50b1N0cmluZygpKTtcclxuICAgICAgICAgIC8vIHNlbmQgbWVzc2FnZSB0b1xyXG4gICAgICAgICAgLy8gb3BlbiBzb2NrZXRzIChjbGllbnQucmVhZHlTdGF0ZSA9PT0gd3MuT1BFTilcclxuICAgICAgICAgIC8vIGluIG15IHJvb20gKGNsaWVudC5yb29tSWQgPT09IHdzLnJvb21JZClcclxuICAgICAgICAgIC8vIHdpdGhvdXQgbWUgKGNsaWVudCAhPT0gd3MpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHdzLm9uKFwiZXJyb3JcIiwgKGVycm9yKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICBhcHAubG9jYWxzLm1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlO1xyXG4gICAgICBhcHAubG9jYWxzLmVycm9yID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwiIHByb2R1Y3Rpb25cIiA/IGVycm9yIDoge307XHJcbiAgICAgIGFwcC5yZW5kZXIoXCJlcnJvclwiKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHdzLm9uKFwiY2xvc2VcIiwgKCkgPT4gY29uc29sZS5sb2coYCR7cmVxLnVybH0gY29ubmVjdGlvbiBjbG9zZWApKTtcclxuICB9KTtcclxufTtcclxuIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQU1BLEVBQUUsR0FBR0MsT0FBTyxDQUFDLElBQUksQ0FBQzs7QUFFeEI7QUFDQTtBQUNBQyxNQUFNLENBQUNDLE9BQU8sR0FBRyxVQUFDQyxNQUFNLEVBQUVDLEdBQUcsRUFBSztFQUNoQztFQUNBLElBQU1DLEdBQUcsR0FBRyxJQUFJTixFQUFFLENBQUNPLE1BQU0sQ0FBQztJQUFFSCxNQUFNLEVBQU5BO0VBQU8sQ0FBQyxDQUFDO0VBQ3JDO0VBQ0E7RUFDQUMsR0FBRyxDQUFDRyxHQUFHLENBQUMsS0FBSyxFQUFFRixHQUFHLENBQUM7O0VBRW5CO0VBQ0FBLEdBQUcsQ0FBQ0csRUFBRSxDQUFDLFlBQVksRUFBRSxVQUFDVCxFQUFFLEVBQUVVLEdBQUcsRUFBSztJQUNoQyxJQUFJQSxHQUFHLENBQUNDLEdBQUcsS0FBSyxRQUFRLEVBQUU7TUFDeEJYLEVBQUUsQ0FBQ1ksUUFBUSxHQUFHLE9BQU87TUFDckI7TUFDQVosRUFBRSxDQUFDYSxJQUFJLENBQUNDLElBQUksQ0FBQ0MsU0FBUyxDQUFDVixHQUFHLENBQUNXLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQ0MsS0FBSyxDQUFDLENBQUM7SUFDbkQsQ0FBQyxNQUFNLElBQUlQLEdBQUcsQ0FBQ0MsR0FBRyxDQUFDTyxVQUFVLENBQUMsUUFBUSxDQUFDLEVBQUU7TUFDdkNsQixFQUFFLENBQUNZLFFBQVEsR0FBR0YsR0FBRyxDQUFDQyxHQUFHLENBQUNRLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7TUFDbkNuQixFQUFFLENBQUNTLEVBQUUsQ0FBQyxTQUFTLEVBQUUsVUFBQ1csT0FBTyxFQUFLO1FBQzVCO1FBQ0E7UUFDQTtRQUNBZCxHQUFHLENBQUNlLE9BQU8sQ0FBQ0MsT0FBTyxDQUFDLFVBQUNDLE1BQU0sRUFBSztVQUM5QixJQUNFQSxNQUFNLEtBQUt2QixFQUFFLElBQ2J1QixNQUFNLENBQUNDLFVBQVUsS0FBS3hCLEVBQUUsQ0FBQ3lCLElBQUksSUFDN0JGLE1BQU0sQ0FBQ1gsUUFBUSxLQUFLWixFQUFFLENBQUNZLFFBQVEsRUFFL0JXLE1BQU0sQ0FBQ1YsSUFBSSxDQUFDTyxPQUFPLENBQUNNLFFBQVEsQ0FBQyxDQUFDLENBQUM7VUFDakM7VUFDQTtVQUNBO1VBQ0E7UUFDRixDQUFDLENBQUM7TUFDSixDQUFDLENBQUM7SUFDSjtJQUVBMUIsRUFBRSxDQUFDUyxFQUFFLENBQUMsT0FBTyxFQUFFLFVBQUNrQixLQUFLLEVBQUs7TUFDeEJDLE9BQU8sQ0FBQ0QsS0FBSyxDQUFDQSxLQUFLLENBQUM7TUFDcEJ0QixHQUFHLENBQUN3QixNQUFNLENBQUNULE9BQU8sR0FBR08sS0FBSyxDQUFDUCxPQUFPO01BQ2xDZixHQUFHLENBQUN3QixNQUFNLENBQUNGLEtBQUssR0FBR0csT0FBTyxDQUFDQyxHQUFHLENBQUNDLFFBQVEsS0FBSyxhQUFhLEdBQUdMLEtBQUssR0FBRyxDQUFDLENBQUM7TUFDdEV0QixHQUFHLENBQUM0QixNQUFNLENBQUMsT0FBTyxDQUFDO0lBQ3JCLENBQUMsQ0FBQztJQUVGakMsRUFBRSxDQUFDUyxFQUFFLENBQUMsT0FBTyxFQUFFO01BQUEsT0FBTW1CLE9BQU8sQ0FBQ00sR0FBRyxJQUFBQyxNQUFBLENBQUl6QixHQUFHLENBQUNDLEdBQUcsc0JBQW1CLENBQUM7SUFBQSxFQUFDO0VBQ2xFLENBQUMsQ0FBQztBQUNKLENBQUMifQ==","map":{"version":3,"names":["ws","require","module","exports","server","app","wss","Server","set","on","req","url","location","send","JSON","stringify","get","rooms","startsWith","split","message","clients","forEach","client","readyState","OPEN","toString","error","console","locals","process","env","NODE_ENV","render","log","concat"],"sourceRoot":"D:\\springboot\\src\\open-chats\\","sources":["socket.js"],"sourcesContent":["const ws = require(\"ws\");\r\n\r\n//module.exports : 모듈을 내보내는 데 사용되는 특수한 객체\r\n//다른 파일에서 해당 모듈을 가져와 사용 가능(require() 이용)\r\nmodule.exports = (server, app) => {\r\n  //ws 모듈의 Server 클래스(WebSocket 서버를 생성하고 관리)를 사용하여 WebSocket 서버를 생성하는 구문\r\n  const wss = new ws.Server({ server });\r\n  // for sending a rooms data when a new room is created\r\n  // used at app.post('newroom') on app.js\r\n  app.set(\"wss\", wss);\r\n\r\n  // Backend에서 socket을 사용할 준비 완료\r\n  wss.on(\"connection\", (ws, req) => {\r\n    if (req.url === \"/rooms\") {\r\n      ws.location = \"index\";\r\n      // get a data when into index\r\n      ws.send(JSON.stringify(app.get(\"dummyDb\").rooms));\r\n    } else if (req.url.startsWith(\"/chat/\")) {\r\n      ws.location = req.url.split(\"/\")[2];\r\n      ws.on(\"message\", (message) => {\r\n        // send message to open sockets in my room without me\r\n        //클라이언트가 현재 메시지를 보낸 클라이언트(ws)와 같지 않고,\r\n        //상태가 OPEN인 경우, 그리고 같은 방(location)에 있는 경우에만 메세지 전송\r\n        wss.clients.forEach((client) => {\r\n          if (\r\n            client !== ws &&\r\n            client.readyState === ws.OPEN &&\r\n            client.location === ws.location\r\n          )\r\n            client.send(message.toString());\r\n          // send message to\r\n          // open sockets (client.readyState === ws.OPEN)\r\n          // in my room (client.roomId === ws.roomId)\r\n          // without me (client !== ws)\r\n        });\r\n      });\r\n    }\r\n\r\n    ws.on(\"error\", (error) => {\r\n      console.error(error);\r\n      app.locals.message = error.message;\r\n      app.locals.error = process.env.NODE_ENV !== \" production\" ? error : {};\r\n      app.render(\"error\");\r\n    });\r\n\r\n    ws.on(\"close\", () => console.log(`${req.url} connection close`));\r\n  });\r\n};\r\n"],"mappings":";;AAAA,IAAMA,EAAE,GAAGC,OAAO,CAAC,IAAI,CAAC;;AAExB;AACA;AACAC,MAAM,CAACC,OAAO,GAAG,UAACC,MAAM,EAAEC,GAAG,EAAK;EAChC;EACA,IAAMC,GAAG,GAAG,IAAIN,EAAE,CAACO,MAAM,CAAC;IAAEH,MAAM,EAANA;EAAO,CAAC,CAAC;EACrC;EACA;EACAC,GAAG,CAACG,GAAG,CAAC,KAAK,EAAEF,GAAG,CAAC;;EAEnB;EACAA,GAAG,CAACG,EAAE,CAAC,YAAY,EAAE,UAACT,EAAE,EAAEU,GAAG,EAAK;IAChC,IAAIA,GAAG,CAACC,GAAG,KAAK,QAAQ,EAAE;MACxBX,EAAE,CAACY,QAAQ,GAAG,OAAO;MACrB;MACAZ,EAAE,CAACa,IAAI,CAACC,IAAI,CAACC,SAAS,CAACV,GAAG,CAACW,GAAG,CAAC,SAAS,CAAC,CAACC,KAAK,CAAC,CAAC;IACnD,CAAC,MAAM,IAAIP,GAAG,CAACC,GAAG,CAACO,UAAU,CAAC,QAAQ,CAAC,EAAE;MACvClB,EAAE,CAACY,QAAQ,GAAGF,GAAG,CAACC,GAAG,CAACQ,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;MACnCnB,EAAE,CAACS,EAAE,CAAC,SAAS,EAAE,UAACW,OAAO,EAAK;QAC5B;QACA;QACA;QACAd,GAAG,CAACe,OAAO,CAACC,OAAO,CAAC,UAACC,MAAM,EAAK;UAC9B,IACEA,MAAM,KAAKvB,EAAE,IACbuB,MAAM,CAACC,UAAU,KAAKxB,EAAE,CAACyB,IAAI,IAC7BF,MAAM,CAACX,QAAQ,KAAKZ,EAAE,CAACY,QAAQ,EAE/BW,MAAM,CAACV,IAAI,CAACO,OAAO,CAACM,QAAQ,CAAC,CAAC,CAAC;UACjC;UACA;UACA;UACA;QACF,CAAC,CAAC;MACJ,CAAC,CAAC;IACJ;IAEA1B,EAAE,CAACS,EAAE,CAAC,OAAO,EAAE,UAACkB,KAAK,EAAK;MACxBC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;MACpBtB,GAAG,CAACwB,MAAM,CAACT,OAAO,GAAGO,KAAK,CAACP,OAAO;MAClCf,GAAG,CAACwB,MAAM,CAACF,KAAK,GAAGG,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa,GAAGL,KAAK,GAAG,CAAC,CAAC;MACtEtB,GAAG,CAAC4B,MAAM,CAAC,OAAO,CAAC;IACrB,CAAC,CAAC;IAEFjC,EAAE,CAACS,EAAE,CAAC,OAAO,EAAE;MAAA,OAAMmB,OAAO,CAACM,GAAG,IAAAC,MAAA,CAAIzB,GAAG,CAACC,GAAG,sBAAmB,CAAC;IAAA,EAAC;EAClE,CAAC,CAAC;AACJ,CAAC"}},"mtime":1705626039513}}